!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";n.r(t),n.d(t,"PlayerInstance",(function(){return c}));var r=n(1);let a=document.getElementById("video_load_form"),o=a.load_button,i=a.url,s=document.getElementById("videolist"),l=document.getElementById("player"),c=new r.default(l,s);o.addEventListener("click",e=>{let t=i.value;i.value="",c.loadFromEvent(t)}),c.setVolume(.1),c.loadFromLocalStorage()},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var r=n(2);class a{constructor(e,t){this.parsers=[{parser:this.isThread,action:this.loadThread},{parser:this.isVideo,action:this.setVideo}],this.playerElem=e,this.listElem=t,this.room=new r.default,this.listeners=[]}addEventListener(e,t){this.listeners.push({event:e,cb:t})}emit(e,...t){this.listeners.forEach((n,r)=>{n.event===e&&n.cb(...t)})}setVolume(e){this.playerElem.volume=e||1}loadFromEvent(e){try{e=new URL(e)}catch(e){throw e}let t=!1;this.parsers.forEach((n,r)=>{if(t)return null;let a=n.parser,o=n.action;a.call(this,e)&&(t=!0,o.call(this,e))})}isThread(e){return e.href.match(/2ch.hk\/[A-z]{1,}\/res\/[0-9]*.\.html/)}isVideo(e){return e.href.match(/.*(mp4|webm)/)}async fetchVideos(e){return fetch("/api/getvideos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e})}).catch(e=>console.log(e)).then(e=>e.json().then(e=>(localStorage.setItem("videos",JSON.stringify(e)),e)))}async renderList(e){this.listElem.textContent="",e.forEach(async e=>{let t=document.createElement("a"),n=document.createElement("img");t.className="preview",t.href=e.video,n.src=e.preview,n.loading="lazy",t.appendChild(n),this.listElem.appendChild(t),t.onclick=t=>{t.preventDefault(),t.target.className="viewed",this.setVideo.call(this,e.video)},await new Promise(async e=>{setTimeout(e,100)})})}loadFromLocalStorage(){let e;(e=localStorage.getItem("videos"))&&(e=JSON.parse(e),this.renderList.call(this,e))}async loadThread(e){let t=await this.fetchVideos.call(this,e);return await this.renderList.call(this,t)}setVideo(e){try{e=new URL(e),this.room.setRoomVideo(e),this.playerElem.src=e.href,this.emit("videochanged",e)}catch(e){throw new Error("Ошибка при смене адреса видео")}}setVideoNotManually(e){try{e=new URL(e),this.playerElem.src=e.href}catch(e){throw new Error("Ошибка при смене адреса видео")}}async init(){let e=await this.room.fetchRoomByName();this.setVideoNotManually(e.video)}play(e=!1){return e&&(a.stopPausePlayEvents=!0),this.playerElem.play()}pause(e=!1){return e&&(a.stopPausePlayEvents=!0),this.playerElem.pause()}currentTime(){return this.playerElem.currentTime}setTime(e){return this.playerElem.currentTime=e}src(){return this.playerElem.src}}},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return r}));class r{constructor(e="main"){this.name=this.extractNameFromLocation()||"main"}extractNameFromLocation(){let e=window.location.href.match(/room\/([0-9]*)/);return e?e[1]:null}async fetchRoomByName(){let e=this.name,t=await fetch("/api/getRoomByName",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e})});return await t.json()}async setRoomVideo(e){let t=this.name,n=await fetch("/api/setRoomVideo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,url:e})});return await n.json()}}},function(e,t,n){"use strict";n.r(t),n.d(t,"socket",(function(){return o}));var r=n(0),a=n(1);const o=io.connect(window.location.origin);o.on("connect",()=>{r.PlayerInstance.init(),o.on("videochanged",e=>{r.PlayerInstance.setVideoNotManually(e)}),o.on("videoplayed",async(e,t)=>{r.PlayerInstance.src()===t&&(r.PlayerInstance.setTime(e),await r.PlayerInstance.play(!0))}),o.on("videopaused",e=>{r.PlayerInstance.src()===e&&r.PlayerInstance.pause(!0)})}),r.PlayerInstance.addEventListener("videochanged",e=>{o.emit("videochanged",e)}),r.PlayerInstance.playerElem.addEventListener("play",e=>{try{a.default.stopPausePlayEvents||o.emit("videoplayed",r.PlayerInstance.currentTime(),url)}finally{a.default.stopPausePlayEvents=!1}}),r.PlayerInstance.playerElem.addEventListener("pause",e=>{try{a.default.stopPausePlayEvents||o.emit("videopaused",url)}finally{a.default.stopPausePlayEvents=!1}}),window.onunload=window.onbeforeunload=()=>{o.close()}}]);